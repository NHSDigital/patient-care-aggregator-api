description: "TBC care plan resource wrapper."
type: object
required:
  - fullUrl
  - resource
  - search
properties:
  fullUrl:
    description: "URI for the TBC resource."
    type: string
    example: "https://servita-sandbox.co.uk/CarePlan/1"
  search:
    description: "Search-related information for the CarePlan resource."
    type: object
    required:
      - mode
    properties:
      mode:
        description: "Indicates why this resource is in the result set."
        enum:
          - match
  resource:
    description: "The TBC resource."
    type: object
    required:
      - resourceType
      - status
      - intent
      - subject
      - activity
    properties:
      resourceType:
        description: "FHIR resource type."
        type: string
        enum:
          - "CarePlan"
      status:
        description: "TBC status."
        type: string
        enum:
          - "TBC"
      intent:
        description: "TBC intent."
        type: string
        enum:
          - "TBC"
      subject:
        description: "TBC subject."
        type: object
#        required:
#          - TBC
        properties:
          identifier:
            description: "TBC identifier."
            type: object
#            required:
#              - TBC
            properties:
              system:
                description: "TBC system."
                type: string
                example: "https://fhir.nhs.uk/Id/nhs-number"
# TBC should this be an enum? Is NHS number the only option?                
              value:
                description: "TBC value."
                type: string
                example: "8462486238"
# TBC should this be 9000000009?                
      activity:
        description: "TBC activity array."
        type: array
        items:
          description: "TBC activity object."
          type: object
          required:
            - detail
          properties:
            reference:
              description: "TBC reference."
# TBC looks like this is only included if the activity has come from e-RS
              type: object
#              required:
#                - TBC
# Confluence says the properties are all optional but I suspect they are required *if* the "reference" object is present
              properties:
                type:
                  description: "TBC type."
                  type: string
                  enum:
                    - "ServiceRequest"
                    - TBC others
                identifier:
                  description: "TBC identifier."
                  type: object
#                  required:
#                    - TBC
                  properties:
                    system:
                      description: "TBC system."
                      type: string
                      example: "https://fhir.nhs.uk/Id/UBRN"
                    value:
                      description: "TBC value."
                      type: string
                      example: "808993698030"
            detail:
              description: "TBC detail object."
              type: object
              required:
                - kind
                - description
                - performer
# Confluence says performer is required but the example has no performer for the "Appointment" activity
              properties:
                kind:
                  description: "TBC kind."
                  type: string
                  enum:
                    - "ServiceRequest"
                    - Appointment"
                extension:
                  description: "TBC detail extension."
                  type: array
                  items:
                    oneOf:
                      - description: "TBC portal link."
                        type: object
#                        required:
#                          - TBC
                        properties:
                          url:
                            description: "TBC url."
                            type: string
                            enum:
                              - "https://fhir.nhs.uk/StructureDefinition/Extension-Portal-Link"
                          valueUrl:
                            description: "TBC valueUrl."
                            type: string
                            example: "https://refer.nhs.uk/nhslogin?ubrn=808993698030"
                          extension:
                            description: "TBC portal link extension array."
                            type: array
                            items:
                              description: "TBC portal link extension object."
                              type: object
#                              required:
#                                - TBC
                              properties:
                                url:
                                  description: "TBC url."
                                  type: string
                                  example: "client-id"
                                valueCode:
                                  description: "TBC valueCode."
                                  type: string
                                  example: "ers-01"
                      - description: "TBC eRS service request state."
                        type: object
#                        required:
#                          - TBC
                        properties:
                          url:
                            description: "TBC url."
                            type: string
                            enum:
                              - "https://fhir.nhs.uk/StructureDefinition/Extension-eRS-ServiceRequest-State"
                          valueCoding:
                            description: "TBC valueCoding."
                            type: object
#                            required:
#                              - TBC
                            properties:
                              system:
                                description: "TBC system."
                                type: string
                                example: "https://fhir.nhs.uk/CodeSystem/eRS-ReferralState"
                              code:
                                description: "TBC code."
                                type: string
                                example: "Bookable"
                      - description: "TBC specialty."
                        type: object
#                        required:
#                          - TBC
                        properties:
                          url:
                            description: "TBC url."
                            type: string
                            enum:
                              - "https://fhir.nhs.uk/StructureDefinition/Extension-Specialty"
                          valueCoding:
                            description: "TBC valueCoding."
                            type: object
#                            required:
#                              - TBC
                            properties:
                              system:
                                description: "TBC system."
                                type: string
                                example: "https://fhir.nhs.uk/STU3/CodeSystem/Specialty-1"
# TBC why is this a STU3 coding? Ah, probably because e-RS is a STU3 API? Shouldn't we be converting it?                                
                              code:
                                description: "TBC code."
                                type: string
                                example: "TRAUMA & ORTHOPAEDICS"
                      - description: "TBC consultation medium."
                        type: object
#                        required:
#                          - TBC
                        properties:
                          url:
                            description: "TBC url."
                            type: string
                            enum:
                              - "https://fhir.nhs.uk/StructureDefinition/Extension-Specialty"
                          valueCode:
                            description: "TBC valueCode."
                            type: string
                            example: "FACE_TO_FACE"
# TBC what are the possible values for this field?
                description:
                  description: "TBC description."
                  type: string
                  example: "Rheumatology - Metabolic Bone (inc Complex and Non-Complex cases) - Freeman - Newcastle FT - RTD"
                scheduledPeriod:
                  description: "TBC scheduledPeriod."
                  type: object
#                  required:
#                    - TBC
                  properties:
                    start:
                      description: "TBC start."
                      type: string                      
                      example: "2021-05-23T10:02:15.960"
                    extension:
                      description: "TBC scheduled period extension."
                      type: array
                      items:
                        oneOf:
                          - description: "TBC planned wait time."
                            type: object
#                            required:
#                              TBC
                            properties:
                              url:
                                description: "TBC."
                                type: string
                                enum:
                                  - "https://fhir.nhs.uk/StructureDefinition/Extension-PlannedWaitTime"
                              valueDuration:
                                description: "TBC."
                                type: object
#                                required:
#                                  TBC
                                properties:
                                  unit:
                                    description: "TBC."
                                    type: string
                                    enum:
                                      - "TBC"
                                  value:
                                    description: "TBC."
                                    type: string
                                    example: "45"
                          - description: "TBC review due date."
                            type: object
#                            required:
#                              TBC
                            properties:
                              url:
                                description: "TBC."
                                type: string
                                enum:
                                  - "https://fhir.nhs.uk/StructureDefinition/Extension-PlannedWaitTime"
                              valueDate:
                                description: "TBC."
                                type: string
                                example: "2020-11-19"
                performer:
                  description: "TBC."
                  type: array
                  items:
                    description: "TBC."
                    type: object
#                    required:
#                      - TBC
                    properties:
                      type:
                        description: "TBC."
                        type: string
                        enum:
                          - "TBC"
                      display:
                        description: "TBC."
                        type: string
                        example: "THE NEWCASTLE UPON TYNE HOSPITALS NHS FOUNDATION TRUST"
# looks like performer could be a HealthcareService or an Organization
